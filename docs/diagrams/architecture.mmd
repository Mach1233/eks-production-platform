%% FinTrack Platform â€” Cloud-Native Architecture
%% Render: paste into https://mermaid.live or view on GitHub

graph TD
    subgraph "User Access"
        A[ğŸ‘¤ User Browser]
    end

    subgraph "AWS Cloud â€” eu-north-1"
        subgraph "VPC: 10.0.0.0/16"
            subgraph "Public Subnets"
                B[ALB Ingress Controller]
                NAT[ğŸ–¥ï¸ NAT Instance<br/>t4g.micro + EIP]
                IGW[Internet Gateway]
            end

            subgraph "Private Subnets"
                subgraph "EKS Cluster"
                    C[ğŸ“¦ FinTrack Pods<br/>Next.js App]
                    ESO[ğŸ” External Secrets<br/>Operator]
                    ARGO[ğŸ”„ ArgoCD]
                    PROM[ğŸ“Š Prometheus]
                    GRAF[ğŸ“ˆ Grafana]
                    FB[ğŸ“‹ Fluent Bit<br/>DaemonSet]
                    KYV[ğŸ›¡ï¸ Kyverno]
                end
            end
        end

        ECR[ğŸ“¦ ECR Registry]
        SM[ğŸ”‘ AWS Secrets Manager]
        CW[â˜ï¸ CloudWatch Logs]
    end

    subgraph "External Services"
        ATLAS[ğŸƒ MongoDB Atlas<br/>M0 Free Tier]
        GH[ğŸ™ GitHub Repo]
    end

    A -->|HTTPS| B
    B --> C
    C -->|MONGODB_URI| ATLAS
    NAT -->|Outbound| IGW
    C -.->|via NAT| NAT

    GH -->|Push| GHA[âš™ï¸ GitHub Actions<br/>Build/Scan/Push]
    GHA -->|Push Image| ECR
    GHA -->|Update Helm Tag| GH
    GH -->|Auto-Sync| ARGO
    ARGO -->|Deploy| C

    SM --> ESO
    ESO -->|Inject Secrets| C

    PROM -->|Scrape Metrics| C
    GRAF -->|Visualize| PROM
    FB -->|Ship Logs| CW
    KYV -->|Enforce Policies| C
